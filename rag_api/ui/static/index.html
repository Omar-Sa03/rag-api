<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RAG Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
      html, body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,0.08); }
      .grid-bg { background-image: radial-gradient(rgba(255,255,255,0.10) 1px, transparent 1px); background-size: 18px 18px; }
      .shadow-soft { box-shadow: 0 20px 60px rgba(0,0,0,0.35); }
    </style>
  </head>
  <body class="min-h-screen bg-slate-950 text-slate-100">
    <div class="absolute inset-0 overflow-hidden">
      <div class="absolute -top-40 -left-40 h-96 w-96 rounded-full bg-fuchsia-500/20 blur-3xl"></div>
      <div class="absolute top-20 -right-40 h-[36rem] w-[36rem] rounded-full bg-cyan-400/20 blur-3xl"></div>
      <div class="absolute bottom-[-200px] left-1/3 h-[42rem] w-[42rem] rounded-full bg-emerald-400/10 blur-3xl"></div>
      <div class="absolute inset-0 grid-bg opacity-40"></div>
    </div>

    <main class="relative mx-auto max-w-6xl px-4 py-10">
      <header class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
        <div>
          <div class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs text-slate-200">
            <span class="h-2 w-2 rounded-full bg-emerald-400"></span>
            <span id="statusText">Connected to API</span>
          </div>
          <h1 class="mt-4 text-3xl font-semibold tracking-tight">RAG Studio</h1>
          <p class="mt-2 max-w-2xl text-slate-300">
            Hybrid retrieval + re-ranking with an interactive workspace. Query your knowledge base, inspect sources, and add new documents.
          </p>
        </div>

        <div class="flex items-center gap-2">
          <button id="btnHealth" class="rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm hover:bg-white/10">Health</button>
          <a href="/docs" target="_blank" class="rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm hover:bg-white/10">Docs</a>
        </div>
      </header>

      <section class="mt-8 grid gap-6 lg:grid-cols-5">
        <div class="glass shadow-soft rounded-2xl border border-white/10 p-5 lg:col-span-3">
          <div class="flex items-center justify-between">
            <h2 class="text-base font-semibold">Ask</h2>
            <div class="text-xs text-slate-300" id="latency"></div>
          </div>

          <div class="mt-4 grid gap-3">
            <label class="text-sm text-slate-300" for="queryInput">Question</label>
            <textarea id="queryInput" rows="4" class="w-full resize-none rounded-xl border border-white/10 bg-black/30 p-3 text-sm outline-none ring-0 focus:border-cyan-300/40" placeholder="e.g. What is Kubernetes?"></textarea>

            <div class="grid grid-cols-2 gap-3 md:grid-cols-4">
              <div class="col-span-1">
                <label class="text-sm text-slate-300" for="modeSelect">Mode</label>
                <select id="modeSelect" class="mt-1 w-full rounded-xl border border-white/10 bg-black/30 p-2 text-sm outline-none focus:border-cyan-300/40">
                  <option value="hybrid" selected>Hybrid</option>
                  <option value="vector">Vector</option>
                  <option value="bm25">BM25</option>
                </select>
              </div>
              <div class="col-span-1">
                <label class="text-sm text-slate-300" for="nResults">Top K</label>
                <input id="nResults" type="number" min="1" max="20" value="5" class="mt-1 w-full rounded-xl border border-white/10 bg-black/30 p-2 text-sm outline-none focus:border-cyan-300/40" />
              </div>
              <div class="col-span-1">
                <label class="text-sm text-slate-300">Re-rank</label>
                <button id="toggleRerank" class="mt-1 w-full rounded-xl border border-white/10 bg-emerald-400/10 p-2 text-sm hover:bg-emerald-400/15">On</button>
              </div>
              <div class="col-span-1">
                <label class="text-sm text-slate-300">Scores</label>
                <button id="toggleScores" class="mt-1 w-full rounded-xl border border-white/10 bg-cyan-400/10 p-2 text-sm hover:bg-cyan-400/15">On</button>
              </div>
            </div>

            <div class="mt-2 flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
              <button id="btnQuery" class="rounded-xl bg-gradient-to-r from-cyan-500 to-fuchsia-500 px-4 py-2 text-sm font-semibold text-white shadow-soft hover:opacity-95">
                Run Query
              </button>
              <div class="text-xs text-slate-400" id="hint">Tip: press Ctrl+Enter to run</div>
            </div>
          </div>

          <div class="mt-5">
            <div class="flex items-center justify-between">
              <h3 class="text-sm font-semibold">Answer</h3>
              <div class="flex gap-2">
                <button id="btnCopy" class="rounded-lg border border-white/10 bg-white/5 px-3 py-1.5 text-xs hover:bg-white/10">Copy</button>
                <button id="btnRaw" class="rounded-lg border border-white/10 bg-white/5 px-3 py-1.5 text-xs hover:bg-white/10">Raw JSON</button>
              </div>
            </div>
            <div id="answerBox" class="mt-2 whitespace-pre-wrap rounded-xl border border-white/10 bg-black/30 p-3 text-sm text-slate-100 min-h-[96px]"></div>
            <pre id="rawBox" class="mt-2 hidden overflow-auto rounded-xl border border-white/10 bg-black/30 p-3 text-xs text-slate-200 max-h-64"></pre>
          </div>
        </div>

        <div class="glass shadow-soft rounded-2xl border border-white/10 p-5 lg:col-span-2">
          <h2 class="text-base font-semibold">Sources</h2>
          <p class="mt-1 text-xs text-slate-300">Click a source to expand. Useful for debugging retrieval and re-ranking.</p>
          <div id="sources" class="mt-4 space-y-3"></div>
        </div>
      </section>

      <section class="mt-6 grid gap-6 lg:grid-cols-2">
        <div class="glass shadow-soft rounded-2xl border border-white/10 p-5">
          <h2 class="text-base font-semibold">Add Knowledge</h2>
          <p class="mt-1 text-xs text-slate-300">Add text directly to your vector store and rebuild BM25 index.</p>
          <label class="mt-4 block text-sm text-slate-300" for="addText">Text</label>
          <textarea id="addText" rows="6" class="mt-1 w-full resize-none rounded-xl border border-white/10 bg-black/30 p-3 text-sm outline-none focus:border-fuchsia-300/40" placeholder="Paste text to add..."></textarea>
          <div class="mt-3 flex items-center justify-between gap-3">
            <div class="flex items-center gap-2 text-xs text-slate-300">
              <input id="addChunk" type="checkbox" class="h-4 w-4" checked />
              <label for="addChunk">Chunk text</label>
            </div>
            <select id="addStrategy" class="rounded-xl border border-white/10 bg-black/30 p-2 text-sm outline-none">
              <option value="recursive" selected>Recursive</option>
              <option value="semantic">Semantic</option>
              <option value="pdf_page_aware">PDF Page Aware</option>
            </select>
          </div>
          <button id="btnAdd" class="mt-4 w-full rounded-xl bg-white/10 px-4 py-2 text-sm font-semibold hover:bg-white/15">Add</button>
          <div id="addResult" class="mt-3 text-xs text-slate-300"></div>
        </div>

        <div class="glass shadow-soft rounded-2xl border border-white/10 p-5">
          <h2 class="text-base font-semibold">Upload Document</h2>
          <p class="mt-1 text-xs text-slate-300">Upload PDF/DOCX/MD/TXT and chunk it into the knowledge base.</p>

          <div class="mt-4 grid gap-3">
            <input id="fileInput" type="file" class="block w-full text-sm text-slate-300 file:mr-4 file:rounded-lg file:border-0 file:bg-white/10 file:px-4 file:py-2 file:text-sm file:font-semibold hover:file:bg-white/15" />

            <div class="grid grid-cols-3 gap-3">
              <div>
                <label class="text-sm text-slate-300">Strategy</label>
                <select id="upStrategy" class="mt-1 w-full rounded-xl border border-white/10 bg-black/30 p-2 text-sm outline-none">
                  <option value="recursive" selected>Recursive</option>
                  <option value="semantic">Semantic</option>
                  <option value="pdf_page_aware">PDF Page Aware</option>
                </select>
              </div>
              <div>
                <label class="text-sm text-slate-300">Chunk</label>
                <input id="upChunkSize" type="number" value="1000" min="100" class="mt-1 w-full rounded-xl border border-white/10 bg-black/30 p-2 text-sm outline-none" />
              </div>
              <div>
                <label class="text-sm text-slate-300">Overlap</label>
                <input id="upOverlap" type="number" value="200" min="0" class="mt-1 w-full rounded-xl border border-white/10 bg-black/30 p-2 text-sm outline-none" />
              </div>
            </div>

            <button id="btnUpload" class="rounded-xl bg-white/10 px-4 py-2 text-sm font-semibold hover:bg-white/15">Upload</button>
            <div id="uploadResult" class="text-xs text-slate-300"></div>
          </div>
        </div>
      </section>

      <footer class="mt-10 text-center text-xs text-slate-400">
        Built into your FastAPI server. UI calls <code class="rounded bg-white/5 px-1 py-0.5">/v1/*</code> endpoints.
      </footer>
    </main>

    <div id="toast" class="pointer-events-none fixed bottom-6 left-1/2 hidden -translate-x-1/2 rounded-xl border border-white/10 bg-black/60 px-4 py-2 text-sm text-slate-100 shadow-soft"></div>

    <script src="/static/app.js"></script>
  </body>
</html>
